import{a7 as I,a9 as P,aa as A,a8 as N,x as g,o as x,A as $,ab as v,ac as T,ad as c,ai as E,c as n,av as f,al as C,ao as d,J as p,ah as w,at as J,au as L}from"./index-2e906d0c.js";import{V as M}from"./VContainer-451776cb.js";import{V as y}from"./VCol-dc2434c8.js";import{V as R}from"./VDivider-bdd82a0d.js";import{V as U}from"./VDataTable-8815a807.js";import"./VList-5a36ea62.js";import"./VMenu-d82125ac.js";const j=u=>(J("data-v-386b114b"),u=u(),L(),u),z=j(()=>f("h1",{style:{color:"white"}},"購物車",-1)),F=["src"],G={key:0},H={key:1,class:"text-red text-decoration-line-through"},K={__name:"Drunk4View",setup(u){const{apiAuth:m}=E(),r=P(),_=A(),b=N(),a=g([]),V=[{title:"商品圖片",key:"product.image"},{title:"商品名稱",key:"product.name"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.product.price*e.quantity},{title:"操作",key:"action"}],B=x(()=>a.value.reduce((e,o)=>e+o.quantity*o.product.price,0)),q=x(()=>a.value.length>0&&!a.value.some(e=>!e.product.sell)),h=async(e,o)=>{var t,s;if(!_.isLogin){b.push("/login");return}try{const{data:l}=await m.patch("/users/cart",{product:e,quantity:o});_.cart=l.result,r({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const i=a.value.findIndex(D=>D.product._id===e);a.value[i].quantity+=o,a.value[i].quantity<=0&&a.value.splice(i,1)}catch(l){const i=((s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";r({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},k=g(!1),S=async()=>{var e,o;k.value=!0;try{await m.post("/orders"),_.cart=0,b.push("/orders"),r({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){const s=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"blue",location:"bottom"}})}k.value=!1};return $(async()=>{var e,o;try{const{data:t}=await m.get("/users/cart");a.value.push(...t.result)}catch(t){const s=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(e,o)=>(v(),T(M,null,{default:c(()=>[n(y,{cols:"12"},{default:c(()=>[z]),_:1}),n(R),n(y,{cols:"12"},{default:c(()=>[n(U,{items:a.value,headers:V},{"item.product.image":c(({item:t})=>[f("img",{src:t.product.image,height:"50px"},null,8,F)]),"item.product.name":c(({item:t})=>[t.product.sell?(v(),C("span",G,d(t.product.name),1)):(v(),C("span",H,d(t.product.name)+" (已下架)",1))]),"item.quantity":c(({item:t})=>[n(p,{variant:"text",icon:"mdi-minus",color:"red",onClick:s=>h(t.product._id,-1)},null,8,["onClick"]),w(" "+d(t.quantity)+" ",1),n(p,{variant:"text",icon:"mdi-plus",color:"green",onClick:s=>h(t.product._id,1)},null,8,["onClick"])]),"item.action":c(({item:t})=>[n(p,{variant:"text",icon:"mdi-delete",color:"red",onClick:s=>h(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),n(y,{class:"text-center",cols:"12",style:{color:"white"}},{default:c(()=>[f("p",null,"總金額: "+d(B.value),1),n(p,{color:"green",disabled:!q.value,loading:k.value,onClick:S},{default:c(()=>[w("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}},et=I(K,[["__scopeId","data-v-386b114b"]]);export{et as default};
