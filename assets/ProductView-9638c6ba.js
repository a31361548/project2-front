import{aB as B,a8 as S,a9 as q,aa as C,x as F,A as M,ab as P,al as $,c as a,ad as o,aC as A,a0 as N,ai as R,V as E,av as n,ao as d,ae as l,af as T,ag as U,J as f,ah as v}from"./index-2e906d0c.js";import{u as j,a as D}from"./vee-validate.esm-018bef8b.js";import{c as I,d as J,V as L}from"./index.esm-de8aadb6.js";import{V as O}from"./VContainer-451776cb.js";import{V as z}from"./VRow-ad76bf31.js";import{V as _}from"./VCol-dc2434c8.js";const G={style:{"white-space":"pre"}},H=n("h1",{class:"text-red text-h1"},"已下架",-1),te={__name:"ProductView",setup(K){const b=B(),m=S(),{api:h,apiAuth:y}=R(),i=q(),p=C(),t=F({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),V=I({quantity:J().typeError("缺少數量").required("缺少數量").min(1,"數量最小為 1")}),{isSubmitting:g,handleSubmit:x}=j({validationSchema:V,initialValues:{quantity:1}}),c=D("quantity"),w=x(async u=>{var s,e;if(!p.isLogin){m.push("/login");return}try{const{data:r}=await y.patch("/users/cart",{product:t.value._id,quantity:u.quantity});p.cart=r.result,i({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(r){const k=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";i({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return M(async()=>{var u,s;try{const{data:e}=await h.get("/products/"+b.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`購物網 | ${t.value.name}`}catch(e){console.log(e);const r=((s=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";i({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"black",location:"bottom"}}),m.push("/")}}),(u,s)=>(P(),$(N,null,[a(O,null,{default:o(()=>[a(z,{style:{"background-color":"white","margin-top":"1.5rem","border-radius":"36px"}},{default:o(()=>[a(_,{cols:"12",md:"6"},{default:o(()=>[a(E,{src:t.value.image},null,8,["src"])]),_:1}),a(_,{cols:"12",md:"6"},{default:o(()=>[n("h1",null,d(t.value.name),1),n("p",null,"$"+d(t.value.price),1),n("p",G,d(t.value.description),1),a(L,{disabled:l(g),onSubmit:T(l(w),["prevent"])},{default:o(()=>[a(U,{type:"number",min:"0",modelValue:l(c).value.value,"onUpdate:modelValue":s[0]||(s[0]=e=>l(c).value.value=e),modelModifiers:{number:!0},"error-messages":l(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(f,{type:"submit","prepend-icon":"mdi-cart",loading:l(g)},{default:o(()=>[v("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(A,{"align-center":"","justify-center":"","text-center":"","model-value":!t.value.sell,persistent:""},{default:o(()=>[H,a(f,{to:"/",color:"green"},{default:o(()=>[v("回首頁")]),_:1})]),_:1},8,["model-value"])],64))}};export{te as default};
