import{a7 as $,aa as J,x as V,o as K,a9 as G,ak as O,ab as g,al as _,c as a,ad as l,ap as Q,a0 as w,ai as W,aq as I,V as X,ae as o,aL as D,ah as u,an as q,ar as h,ao as x,af as Y,aw as Z,ag as k,as as ee,aK as ae,J as R,at as le,au as te,av as oe}from"./index-2e906d0c.js";import{c as se,a as C,V as ue}from"./index.esm-de8aadb6.js";import{u as ne,a as S}from"./vee-validate.esm-018bef8b.js";import{V as re}from"./VContainer-451776cb.js";import{V as F}from"./VRow-ad76bf31.js";import{V as n}from"./VCol-dc2434c8.js";const de=r=>(le("data-v-83c3e1ec"),r=r(),te(),r),ie=de(()=>oe("h1",{class:"text-center"},"個人資料",-1)),ce={__name:"HomeView",setup(r){const s=J(),d=V(!1),T=[{icon:"mdi-account",text:"帳號"},{icon:"mdi-email",text:"信箱"},{icon:"mdi-cellphone",text:"手機"}],j=K(()=>[{value:s.account},{value:s.email},{value:s.phone}]),{apiAuth:z}=W(),B=G(),A=V(null),E=()=>{i.value.value=s.account,c.value.value=s.email,m.value.value=s.phone,d.value=!0},M=()=>{d.value=!1,P(),A.value.deleteFileRecord()},H=se({account:C().required("帳號為必填"),email:C().email("信箱格式不正確").required("信箱為必填"),phone:C().required("手機為必填")}),{handleSubmit:N,isSubmitting:y,resetForm:P}=ne({validationSchema:H}),i=S("account"),c=S("email"),m=S("phone"),p=V([]),U=V([]),L=N(async b=>{var t,f;try{const e=new FormData;for(const v in b)e.append(v,b[v]);p.value.length>0&&e.append("image",p.value[0].file),console.log(e),await z.patch("/users/"+s._id,e),B({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),s.getProfile(),M()}catch(e){console.log(e);const v=((f=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:f.message)||"發生錯誤，請稍後再試";B({text:v,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(b,t)=>{const f=O("VueFileAgent");return g(),_(w,null,[a(re,null,{default:l(()=>[a(F,{style:{display:"flex","justify-content":"center"}},{default:l(()=>[a(n,{cols:"12"},{default:l(()=>[ie]),_:1}),a(I,{width:"800px",style:{"padding-left":"30px","padding-top":"15px"}},{default:l(()=>[a(F,null,{default:l(()=>[a(n,{cols:"4"},{default:l(()=>[a(X,{class:"avatar",src:o(s).avatar,style:{height:"150px",width:"150px"}},null,8,["src"])]),_:1}),a(n,{cols:"8",style:{display:"flex","justify-content":"end"}},{default:l(()=>[a(D,{color:"primary",size:"40px",style:{"margin-right":"20px"},onClick:E},{default:l(()=>[u("mdi-pencil")]),_:1})]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(n,{cols:"4"},{default:l(()=>[(g(),_(w,null,q(T,e=>a(h,{key:e.text},{default:l(()=>[a(D,null,{default:l(()=>[u(x(e.icon),1)]),_:2},1024),u(" "+x(e.text),1)]),_:2},1024)),64))]),_:1}),a(n,{cols:"6"},{default:l(()=>[(g(!0),_(w,null,q(j.value,e=>(g(),_("span",{key:e.value},[a(h,null,{default:l(()=>[u(x(e.value),1)]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{modelValue:d.value,"onUpdate:modelValue":t[5]||(t[5]=e=>d.value=e)},{default:l(()=>[a(ue,{disabled:o(y),onSubmit:Y(o(L),["prevent"])},{default:l(()=>[a(I,null,{default:l(()=>[a(Z,null,{default:l(()=>[u(x("編輯個人資料"))]),_:1}),a(h,null,{default:l(()=>[a(k,{label:"帳號",modelValue:o(i).value.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o(i).value.value=e),"error-messages":o(i).errorMessage.value},null,8,["modelValue","error-messages"]),a(k,{label:"信箱",modelValue:o(c).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o(c).value.value=e),"error-messages":o(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(k,{label:"手機",modelValue:o(m).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>o(m).value.value=e),"error-messages":o(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(f,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e),"raw-model-value":U.value,"onUpdate:rawModelValue":t[4]||(t[4]=e=>U.value=e),accept:"image/jpg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:A},null,8,["modelValue","raw-model-value"]),a(ee,null,{default:l(()=>[a(ae),a(R,{color:"secondary",rounded:"",disabled:o(y),onClick:M},{default:l(()=>[u("取消")]),_:1},8,["disabled"]),a(R,{color:"primary",rounded:"",type:"submit",loading:o(y)},{default:l(()=>[u("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}},_e=$(ce,[["__scopeId","data-v-83c3e1ec"]]);export{_e as default};
